!function(){function e(e,n){for(var r,a,o,s,u,l,f,c,h=0;e.length;){if(r=i.exec(e),!r)return null;a=r[0];var s=r.index;if(h+s>=n)return null;if(l=s+a.length,e=e.slice(l),a.match(/^\\begin/)){var d=r[1];c=new RegExp("[^\\\\]\\\\end\\{"+d+"\\}")}else c=a.match(/.\$/)?t[a.slice(1)]:t[a];if(r=c.exec(e),!r)return{start:h+s,end:h+l+e.length,math:e,startDelimiter:a,endDelimiter:o};o=r[0];var u=r.index+1;if(f=u+o.length-1,h+l+u>=n)return{start:h+s,end:h+l+f,math:e.slice(0,u),startDelimiter:a,endDelimiter:o.slice(1)};e=e.slice(f),h+=l+f}}var t={$:/[^\\]\$/,"\\(":/[^\\]\\\)/,$$:/[^\\]\$\$/,"\\[":/[^\\]\\\]/},i=/(?:^|[^\\])\$\$|(?:^|[^\\])\$|\\\(|\\\[|\\begin\{(\w+)\}/;jQuery(function(){jQuery("<style type='text/css'> .wm_preview { z-index: 1; position: absolute; display: none; border: 1px solid; padding: 0.2em; width: auto; margin: 0 auto; background: white;} </style>").appendTo("head"),jQuery.fn.writemaths=function(t){return jQuery(this).each(function(){function i(){var e=o.of?o.of:o.iFrame?a:s?u:document;l.position({my:o.previewPosition,at:o.position,of:e,collision:"fit"})}function n(){if(l.hide(),s)c=jQuery(this).getSelection(),h={startOffset:c.start,endOffset:c.end},f=jQuery(this).val();else{c=o.iFrame?rangy.getIframeSelection(a):rangy.getSelection();var t=c.anchorNode;if(h=c.getRangeAt(0),t.nodeType==t.TEXT_NODE){for(;t.previousSibling;)t=t.previousSibling,h.startOffset+=t.textContent.length,h.endOffset+=t.textContent.length;t=t.parentNode}if(jQuery(t).add(jQuery(t).parents()).filter("code,pre,.wm_ignore").length)return;f=jQuery(t).text()}if(h.startOffset==h.endOffset){var n=h.startOffset,r=e(f,n);if(r){var u;if(u=r.startDelimiter.match(/^\\begin/)?r.startDelimiter+r.math+(r.endDelimiter?r.endDelimiter:""):r.math,u.length){if(l.show(),u!=$(this).data("writemaths-lastMath")){var m=document.createElement("script");m.setAttribute("type","math/tex"),m.textContent=o.cleanMaths(u),l.html(m),$(this).data("writemaths-lastMath",u),d.Push(["Typeset",MathJax.Hub,l[0]]),d.Push(i),d.Push(o.callback)}i()}}}}var r,a,o=jQuery.extend({cleanMaths:function(e){return e},callback:function(){},iFrame:!1,position:"left top",previewPosition:"left top"},t),s=jQuery(this).is("textarea,input"),u=this;"this"==o.of&&(o.of=u),o.iFrame?(a=jQuery(this).find("iframe")[0],r=jQuery(a).contents().find("body")):r=jQuery(this),r.addClass("writemaths tex2jax_ignore");var l=jQuery('<div class="wm_preview"/>');jQuery("body").append(l);var f,c,h,d=MathJax.Callback.Queue(MathJax.Hub.Register.StartupHook("End",{}));n=$.throttle(100,n),r.on("blur",function(){l.hide()}).on("keyup click",n),o.iFrame?$(r[0].ownerDocument).on("scroll",n):r.on("scroll",n)}),this}}),function(e,t){var i,n=e.jQuery||e.Cowboy||(e.Cowboy={});n.throttle=i=function(e,i,r,a){function o(){function n(){u=+new Date,r.apply(l,c)}function o(){s=t}var l=this,f=+new Date-u,c=arguments;a&&!s&&n(),s&&clearTimeout(s),a===t&&f>e?n():i!==!0&&(s=setTimeout(a?o:n,a===t?e-f:e))}var s,u=0;return"boolean"!=typeof i&&(a=r,r=i,i=t),n.guid&&(o.guid=r.guid=r.guid||n.guid++),o},n.debounce=function(e,n,r){return r===t?i(e,n,!1):i(e,r,n!==!1)}}(this)}();